CALCULATE:
	RST	$28
	DEFW	L35BF	; STK-PNTRS
	LD	A,B
	LD	(BREG),A
	EXX
	EX	(SP),HL
	EXX
RE_ENTRY:
	LD	(STKEND),DE
	EXX
	LD	A,(HL)
	INC	HL
	PUSH	HL
	AND	A
	JP	P,FIRST_3D
	LD	D,A
	AND	$60
	RRCA
	RRCA
	RRCA
	RRCA
	ADD	A,$7C
	LD	L,A
	LD	A,D
	AND	$1F
	JR	ENT_TABLE
FIRST_3D:
	CP	$18
	JR	NC,DOUBLE_A
	EXX
	LD	BC,$FFFB
	LD	D,H
	LD	E,L
	ADD	HL,BC
	EXX
DOUBLE_A:
	CP	$38		; end-calc?
	JR	Z,END_CALC
	RLCA
	LD	L,A
ENT_TABLE:
	LD	DE,L32D7
	LD	H,$00
	ADD	HL,DE
	RST	$28
	DEFW	X2AF0		; LD DE,(HL) in ROM1
	LD	HL,RE_ENTRY
	EX	(SP),HL
	PUSH	HL
	LD	HL,SWAP
	EX	(SP),HL
	PUSH	DE
	EXX
	LD	BC,(BREG-1)
	JP	SWAP
END_CALC:
	POP	HL
	EX	(SP),HL
	EXX
	RET
